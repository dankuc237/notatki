forward proxy - single point of exit from network
reverse proxy - single point of enterance to network

# Spawning TTY Shells
https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/full-ttys

[[(reverse) shell#Upgrade dummy shell]]
# Command Shell to Meterpreter
# SSH
połączenie ssh
https://unix.stackexchange.com/questions/23291/how-to-ssh-to-remote-server-using-a-private-key
```bash
ssh -p 1234 user@IP/Hostaname
```

| |                                                                                                                                                                         |
| ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `-i a.key` | klucz prywatny użytkownika utworzony na hoście zdalnym (jeśli istnieje to można go skopiować do siebie, oddzielny plik, zmienić chmod 600, dodać jako argument do ssh ) |
| `-p`       | port na którym się połączyć                                                                                                                                             |

można się zalogować nie wykonując .bashrc (plik uruchamiany przy starcie nowego terminala)
```bash
# wygenerować u siebie klucz RSA
(kck@kck)$ ssh-keygen -f <id_rsa>   
# nadać odpowiednie uprawnienia plikom
(kck@kck)$ chmod 600 ~/.ssh/nazwa (id_rsa domyślnie)
(kck@kck)$ chmod 600 ~/.ssh/nazwa.pub (id_rsa.pub domyślnie)
(kck@kck)$ chmod 700 ~/.ssh
# umieścić swój klucz publiczny w  ofiary pliku
(nazwa_ofiary@ofiara)$ nano ~/.ssh/authorized_keys 
# wykorzystanie klucza prywatnego do logowania bez hasła
(kck@kck)$ ssh -i <id_rsa> nazwa_ofiary@ofiara 
```

## SSH Port Forwarding (SSH Tunneling)
### Local/Remote
https://www.ssh.com/academy/ssh/tunneling-example  

dobrze wytłumaczone różnice między forwardingiem ssh:  
https://phoenixnap.com/kb/ssh-port-forwarding#ftoc-heading-4  

[What is the difference between Local/Remote/Dynamic SSH tunneling?](https://serverfault.com/questions/272754/what-is-the-difference-between-local-remote-dynamic-ssh-tunneling)

https://www.youtube.com/watch?v=AtuAdk4MwWw

|            |           what you acces            |                |         what you get         |               |
| :--------- | :---------------------------------: | :------------: | :--------------------------: | ------------: |
|            |      do czego mam mieć dostęp       |                |   przez co mam mieć dostęp   |               |
| **Local**  |        na lokalnej maszynie         | masz dostęp do | zdalnych zasobów pod adresem |               |
| `ssh -L`   |      `(Local_IP :) Local_Port`      |      `:`       |  ` Remote_IP : Remote_Port`  | `user@server` |
| **Remote** | z adresu zdalnego servera (IP:port) | masz dostęp do |      lokalnych zasobów       |               |
| `ssh -R`   |     `(Remote_IP :) Remote_Port`     |      `:`       |   `Local_IP : Local_Port`    | `user@server` |
|            |

```bash
ssh -L 127.0.0.1:8000:localhost:80 server
na lokalnym porcie 8000 aktualnej maszyny (127.0.0.1:8000) będzie dostępna aplikacja z serwera z portu localhost:80 
```
```bash
ssh -R  0.0.0.0:2222:127.0.0.1:22 server
na porcie 2222 servera zdalnego będzie dostęp do adresu 127.0.0.1:22 lokalnej maszyny, z której rozpoczęty został tunel
*0.0.0.0 - serwer nasłuchuje na każdym adresie (nie tylko na localhost)
```

### Dynamic
tzw socks proxy
```bash
ssh –D local_port ssh_server_hostname
ssh –D 5534 pnap@ssh.server.com
```
You are now able to configure a local resource, like a browser, to use proxy localhost on port 5534. All traffic originating from that resource is directed through the SSH connections established for the defined port.
ustawienie przeglądarki żeby korzystała z proxy localhost:5534 sprawia, że wysyła wszystko do tunelu.

For dynamic forwarding to work, you would need to configure and enable each application for the SOCKS proxy server.
# scp
opcje jak w ssh (-i ...)
kopiuje poprzez ssh
scp linpeas.sh paul@routerspace:.
scp (co,skąd) (gdzie)  
kopia **pliku** z lokalnej maszyny do zdalne z zachowanem nazwy pliku
```bash
scp /home/user_name/filename user_name@IP_zdalne:/home/user_name/
```

^44c20a

kopia **pliku** z lokalnej maszyny do zdalne ze zmianą nazwy nowego pliku
```bash
scp /home/user_name/filename user_name@IP_zdalne:/home/user_name/new_filename
```
kopia **folderu** z lokalnej maszyny do zdalne z zachowanem nazwy
```bash
scp /home/user_name/directoryname user_name@IP_zdalne:/home/user_name
```
kopia **folderu** z lokalnej maszyny do zdalne ze zmianą nazwy
```bash
scp /home/user_name/directoryname user_name@IP_zdalne:/home/user_name/new_directoryname
```

^b6c3b4

# nc/netcat
```bash
#nasłuchuj połączenia
nc -lvp <port>
```

|      |                                                                |
| ---- | -------------------------------------------------------------- |
| `-l` | listen (nasłuchuj na porcie, czekaj na przychodzące poączenia) |
| `-v` | verbose                                                        |
| `-p` | numer portu                                                    |

```bash
# nawiąż połączenie z IP:PORT
nc -v IP PORT
```
# Reverse shell
https://github.com/lukechilds/reverse-shell  
reverse shell cheat sheet: https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md

## Reverse Shell as a Service
https://reverse-shell.sh/yourip:port 

# Upgrade dummy shell
różne metody spawnu powłoki (nie tylko python): http://netsec.ws/?p=337  
pełen upgrade https://null-byte.wonderhowto.com/how-to/upgrade-dumb-shell-fully-interactive-shell-for-more-flexibility-0197224/

```bash
echo $TERM # own terminal info, zapisać jaki terminal
stty -a # own terminal info, zapisać ilość kolumn i wierszy
stty raw -echo && fg # allow to pass keyboard shortcuts through
```
```bash
#VICTIM
#1
python3 -c 'import pty; pty.spawn("/bin/bash")'
#2
SHELL=/bin/bash script -q /dev/null

export TERM=xterm-256color;export SHELL=bash;stty rows 40 cols 200

*CTRL-Z*

#HACKER
stty raw -echo && fg

# ENTER
```

# Escape from Restricted Shells